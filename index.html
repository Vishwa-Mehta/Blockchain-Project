<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel = "stylesheet" href = "./index.css"/>
	<title>Educational Records</title>
  </head>
  <body>
    	<h1 class="text-center">Educational Records</h1>
        <div>          
          <div id="content1">
            <form role="form" class="form1">
                <!-- <div class="input-group"> -->
					<label class="labelx">Enter Student Details: </label>
					<div id = "side1">
						
						<label class="label1">Student Name: </label>
						<br>
						<input placeholder= "Student Name" name="name" id ="inp1" class="label1 inp"></input>
						<br><br>
						<label class="label1">SRN: </label>
						<br>
						<input placeholder= "SRN" name="srn" id ="inp2" class="label1 inp"></input>
						<br><br>
						<label class="label1">Mathematics: </label>
						<br>
						<input placeholder= "Mathematics" name="marks1" id ="inp3" class="label1 inp"></input>
						<br><br>
					</div>
					<div id = "side2">
						<label class="label1">Science: </label>
						<br>
						<input placeholder= "Science" name="marks2" id ="inp4" class="label1 inp"></input>
						<br><br>
						<label class="label1">English: </label>
						<br>
						<input placeholder= "English" name="marks3" id ="inp5" class="label1 inp"></input>
						<br><br>
						<label class="label1">Social Science: </label>
						<br>
						<input placeholder= "Social Science" name="marks4" id ="inp6" class="label1 inp"></input>
						<br><br>
						<label class="label1">Computer Science: </label>
						<br>
						<input placeholder= "Computer Science" name="marks5" id ="inp7" class="label1 inp"></input>
					</div>
					<!-- <br> -->
					<br>
                	<button type="button" id="button1" class="label1 inp addbutton" onclick="conf()">Add Records</button>
            </form>
		</div>

		<div id = "content2">
	    <label class = "label2">Get Student Records: </label>
	    <br><br>
	    <label class = "label2">Enter Student SRN:</label>
	    <br>
        <input name="retrieve" id ="inp8" class="label2 inp" placeholder="Student SRN"></input>
	    <br><br>
        <button type="button" id = "button2" class="label2 inp" onclick="check()">Get Information</button>
		<br><br>
	    <div id = "name" class="label2"></div>
	    <div id = "srn" class="label2"></div>
	    <div id = "m1" class="label2"></div>
	    <div id = "m2" class="label2"></div>
	    <div id = "m3" class="label2"></div>
	    <div id = "m4" class="label2"></div>
	    <div id = "m5" class="label2"></div>
	</div>

    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.36/dist/web3.min.js"></script>
    <script src = "https://code.jquery.com/jquery-3.3.1.slim.min.js" crossorigin="anonymous"></script>
    <script>
      // Initialize Web3
      if (typeof web3 !== 'undefined') {
        web3 = new Web3(web3.currentProvider);
      } else {
        web3 = new Web3(new Web3.providers.HttpProvider('http://localhost:7545'));
      }

      // Set Account
      web3.eth.defaultAccount = web3.eth.accounts[0];

      // Set Contract Abi
      var contractAbi = [
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "stud_srn",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "password",
				"type": "string"
			}
		],
		"name": "addUser",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "srn",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "marks1",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "marks2",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "marks3",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "marks4",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "marks5",
				"type": "uint256"
			}
		],
		"name": "setStudentInformation",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "srn",
				"type": "string"
			}
		],
		"name": "getSignupDetails",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "stud_srn",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "password",
						"type": "string"
					}
				],
				"internalType": "struct Student_Record.details",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "srn",
				"type": "string"
			}
		],
		"name": "getStudentInformation",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "name",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "srn",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "marks1",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "marks2",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "marks3",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "marks4",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "marks5",
						"type": "uint256"
					}
				],
				"internalType": "struct Student_Record.student",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
 // Add Your Contract ABI here!!!

      // Set Contract Address
    var contractAddress = ''; // Add Your Contract address here

      // Set the Contract
    var contract = new web3.eth.Contract(contractAbi,contractAddress);
    async function check() {
		event.preventDefault();
		var id = String(document.getElementById("inp8").value);
		console.log(id);
		if(id!=""){
		const p = await contract.methods.getStudentInformation(id).call({from:"",gas:500000}); //Enter Ganache Wallet Address here
		console.log(p[0],p[1],p[2],p[3],p[4],p[5],p[6]);
		document.getElementById("name").innerText = "Student Name: " + p[0];
		document.getElementById("srn").innerText = "SRN: " + p[1];
		document.getElementById("m1").innerText = "Mathematics: " + p[2];
		document.getElementById("m2").innerText = "Science: " + p[3];
		document.getElementById("m3").innerText = "English: " + p[4];
		document.getElementById("m4").innerText = "Social Science: " + p[5];
		document.getElementById("m5").innerText = "Computer Science: " + p[6];
		}
		else{
			alert("it's empty");
		}
    }

    function conf() {
        var name = String(document.getElementById("inp1").value);
        var srn = String(document.getElementById("inp2").value);
        var marks1 = String(document.getElementById("inp3").value);
        var marks2 = String(document.getElementById("inp4").value);
        var marks3 = String(document.getElementById("inp5").value);
        var marks4 = String(document.getElementById("inp6").value);
        var marks5 = String(document.getElementById("inp7").value);
        console.log(name)
        if (name!="" & srn!="" & marks1!="" & marks2!="" & marks3!="" & marks4!="" & marks5 != ""){
        contract.methods.setStudentInformation(name, srn, marks1, marks2, marks3, marks4, marks5).send({ from:"",gas:500000}) //Enter Ganache Wallet Address here
            .then((receipt) => {
                console.log(receipt);
                alert('added to blockchain');
            })
            .catch((error) => {
                console.error(error);
            });
        }
        else{
          alert("no values");
        }
    }
    </script>
  </body>
</html>
